 MAPPING THE SAGAN MEMORIAL STATION SITE:  GEOMETRIC CONTROL WITH SELF-CALIBRATION OF THE IMP CAMERA AND IMPLICATIONS FOR FUTURE MARS LANDERS.  R. L. Kirk, E. Howington-Kraus, D. Cook, T. M. Hare, and K. Becker1, 1 U.S. Geological Survey, 2255 N. Gemini Dr., Flagstaff  AZ 86001 (rkirk@usgs.gov). Introduction:  A major element of USGS participation in the Mars Pathfinder mission was identified early on as the post-realtime production of the highest possible quality cartographic products from Imager for Mars Pathfinder (IMP) images.  The cornerstone of these products, and their equivalents from future Mars lander missions,  is a highly accurate geometric control solution, derived by photogrammetric bundle-block adjustment, yielding the improved estimates of the camera angles needed to make seamless products (plus estimate of the positions of object points in the landing site, which are useful for controlling additional images not in the original solution).  A second key element is a digital topographic model (DTM) of the landing site, compiled from the stereoimagery, that is as detailed as practically possible and has been subjected to thorough quality control and editing to eliminate stereomatching errors.  This abstract describes the difficult process by which we recently arrived at a satisfactory sitewide control solution for Mars Pathfinder; in our poster we will show a sampling of the derived dataproducts based on the control solution.  The key lesson of our experience is that achieving the desired subpixel accuracy of the control network required us to refine some of the geometric parameters of the IMP by including them as unknowns in the bundle-block adjustment, a process known as selfcalibration.  Refinement of the camera parameters by selfcalibration will be necessary for future Mars lander missions also, and should be planned for and carried out early in the mission.  Because the DTM data from IMP were collected (manually) before the self-calibration process, a special effort was necessary to reconcile them with the improved camera information. Background: Image data.  The ~16,000 images returned by IMP greatly exceeded expectations.  The data relevant to cartography [1] includes five panoramic datasets (two obtained before deployment of the camera mast, three after) with varying combinations of stereo and multispectral images in each look direction, varying levels of data compression, and varying local solar times.  The key dataset for geometric control is the post-deploy Super Pan, which included stereo images with low compression factors (as well as all spectral bands). Unfortunately, this pan was only ~85% complete at end of mission so the post-deploy portion of the control net must be supplemented by images from the Monster Pan and Gallery Pan.  Super Pan stereopairs, supplemented by those from the Monster Pan, were also used for DTM collection. The predeploy Insurance Pan, which also includes stereo coverage with low compression, contributes geometric strength to the control solution because of the large vertical separation between pre- and post-deploy camera positions. Software and processing approach.  Processing of the IMP data employs a combination of the USGS digital cartographic software ISIS and a commercial digital photogrammetric workstation from LH Systems running the proprietary software SOCET SET.  For the most part, ISIS is used for mission-specific steps (image ingestion and radiometric calibration) and "two-dimensional" processes such as image reprojection and mosaicking, while SOCET SET is used for "three-dimensional" processing such as DTM extraction and editing [2].  An important exception is that the control network for the site is calculated by using a bundle-adjustment program written by us as part of ISIS that captures the geometric constraints on camera position and pointing for the IMP and similar rotating stereocameras. DTM collection.  We were unable in 1997-98 to "finetune" the automatic stereomatching algorithm of SOCET SET so it could collect DTM data successfully.  Many months were therefore devoted to collecting all ~5x105 DTM data points manually by using the stereo display and 3D input device.  DTM data for each stereopair were collected in a "local" coordinate system relative to the camera head, with the expectation that, once the completed control process yielded corrected values of camera head pointing (azimuth and elevation), each DTM segment could be rigidly rotated and translated from local to global coordinates. Data products.  These [1, 3] include multispectral image "cubes" containing all bands obtained with given camera pointing and panoramic mosaics of these cubes.  Both the individual cubes and the mosaics are prepared in two versions: separate right-camera and left-camera datasets with the bands of that camera aligned by shifting the images in a cube, and a combined product in which all bands have been rectified (based on the DTM data) to a common viewpoint at the center of the camera head.  All these datasets are accompanied by coregistered arrays giving the three global coordinates and two independent components of surface normal at each pixel.  Selected image bands (Gallery Pan red, green, and blue), the elevation coordinate, and the surface normal are prepared as planimetric maps, i.e., rectified to a global XY grid. Achievement of Subpixel Control:  We earlier reported a RMS residual error in our control calculations of  0.7 pixels, with a maximum error of ~15 pixels [2, 3].  These results have been greatly improved with further work, as indicated in Table 1. Part of this improvement was the expected result of developing and using correlation techniques to refine manual image measurements to subpixel accuracy, plus a strenuous effort to quality-control the data and eliminate or correct blundered measurements.  What was initially unexpected was the need to self-calibrate the IMP camera as part of the control process in order to reach subpixel accuracy. Our early control calculations [2] included a nonzero rotation of all images (left and right) around the look direction, but the first indication of the need to include additional parameters in the adjustment process arose when we began to collect data to tie non-panorama images to the control network [3].  Some of these image sets were clearly rotated around the direction of look relative to the images to which they were being tied.  As we gradually improved the quality of our image measurements, we found evidence of both a relative rotation between the left and right cameras (nearly the same for all stereopairs) and a rotation of the entire camera head (affecting left and right images equally) that varied randomly from one image set to another. It is not known whether this variation results from flexure of the camera mast, movement of the spacecraft on its airbags, or some other effect.  The camera-head rotations show no systematic pattern with respect to time of day, day of year, or azimuth. The relative twist between the cameras, which is plausibly explained in terms of a small alignment error in the fold IMP CONTROL WITH SELF-CALIBRATION:  R. L. Kirk et al. ing optics, threw in question our previous determination of the toein angles and boresight-error angles [2].  These were based on a few observations of horizon features, for which the stereo parallax was <<1 pixel and could be ignored.  Because these features were not distributed across the whole image, the estimated toein and boresight angles derived from them were correlated with the assumed twist angle.  We therefore modified our bundle-adjustment software to include the toein and boresight-error angles, relative twist of left and right cameras, and a separate camera head twist for every image set as adjustable parameters.  Separate toein and boresight angles can be estimated for each filter included in the adjustment; two of the four angles for each filter (left boresight and right toein) are held fixed because adjusting both cameras independently would be redundant with adjusting the camera-head azimuth and elevation.  Azimuth closure of the image set is absolutely essential for estimation of twists. Table 1—IMP Control Network Statistics Super Pan Ins. Pan Combined Images 284 142 426 Points 672 194 1083 Unknowns 2460 798 3908 Measurements 2843 703 4365 Knowns 5686 1406 8730 Redundancy 2.31 1.76 2.23 RMS Error 0.273 0.168 0.263 Max Error 0.965 0.555 1.266 0L Toein > NA 13.452 13.379 5L Toein > 13.898 NA 13.734 0R Bore ^ NA 1.586 1.633 5R Bore ^ 1.115 NA 1.116 Rel Twist -0.678 -0.713 -0.642 σ Cam Twist 8.736 20.714 7.923 Errors in pixels, angles in mRad. σ=standard deviation.  NA= not applicable because dataset did not include the specified filter. The statistics in Table 1 are for a control network somewhat reduced from our earlier plans [2, 3].  We eliminated images of the Pathfinder spacecraft during the primary adjustment incorporating self-calibration.  Errors for points on the spacecraft are typically higher than for points farther from the camera, suggesting there are some additional uncertainties in camera dimensions such as the separation of azimuth and elevation pivot axes, that only show up at very close range.  We therefore performed the self-calibration by using only the images and points of the landing site itself, in order not to bias the estimated camera. The Super Pan and Insurance Pan images of the spacecraft (along with the other panoramic and non-panoramic image sets) were later controlled in a secondary adjustment in which the images of the primary network and the self-calibrated parameters were held fixed.  Comparison of the estimated camera angles derived from the Super Pan alone, Insurance Pan alone, and the combination gives an indication of the precision of the results:  for example, the relative twist angle estimates are consistent to <0.1 mRad.  The estimates derived from the combined dataset were adopted in our further work. Calibration of the Remaining Bands:  The selfcalibration process yielded estimates of the toein and boresight-error angles only for the bands used as source data:  5 (red) in the Super Pan and 0 (blue) in the Insurance Pan.  We previously reported values of these angles for the other bands derived by averaging the results of automatic matching between bands of the Super Pan image sets [2].  Table 2 gives revised values for the angles, tied to the results of the self calibration for Band 5 and using an improved version of the ISIS image-matching software.  Consistent with our previous results, we found that 80% of the match results had a standard deviation on the order of 0.15—0.3 pixel but the remainder were outliers by >1 to as much as 14 pixels.  These outliers were excluded from the calculation of the mean angles in Table 2.  All of our cartographic products are based on the use of the actual measured alignment between bands of each image set and the band whose az and el are known from the control net, rather than the averages reported here. Table 2—Toein and Boresight-Error Angles Band Toein Bore Err 0L 13.397 -0.068 5L 13.734 0.000 6L 13.311 0.124 7L 13.568 -0.084 8L 13.519 -0.062 9L 13.204 -0.102 10L 13.417 -0.349 11L 13.336 0.131 0R -25.144 1.630 5R -24.630 1.116 6R -24.551 1.037 8R -24.752 1.238 9R -24.312 0.798 10R -25.443 1.929 11R -24.782 1.266 Angles in mRad, signs as [1].  Values for filter 5 from self-calibration. Impact on DTM Collection:  The coordinates of our DTM points are calculated by SOCET SET from the matching pixel coordinates in the stereo images (which remain valid but are unfortunately not stored) and the camera positions and angles relative to the local camera-head coordinates (which are changed as a result of self-calibration).  Rather than re-collecting the entire DTM dataset, we corrected the existing data with a program that projects the local coordinates of each point into each image with the old toein, boresight, and twist angles, then projects these pixels back into local coordinates with the new angles.  Stereo display confirms that the results are consistent with the new orientation of the images.  Because the X and Y coordinates as well as Z are modified, DTM data that was initially collected on a uniform XY grid must be converted to triangulated irregular network (TIN) format.  Typical movement of the points in X and Y is equivalent to a few pixels. Implications for Future Missions:  Our experience processing the Mars Pathfinder data suggests that inflight geometric calibration, including self-calibration, will be an important early task in future Mars lander missions carrying similar stereocameras.  Some parameters (e.g. for IMP, toeins of most bands) may not be measured before flight.  Others may incorrectly be assumed known from the design (e.g., twist) while yet others may differ before and during flight (e.g., filter 5 toein/boresight).  Mission planning should therefore include acquisition and analysis of the data needed for inflight calibration (one 360° pan with low compression) early in the mission and use of the results to improve products thenceforth.  We plan to carry out such calibration of the 2003 Mars Exploration Rover Pancam; our poster will show results of self-calibration of the very similar APEX Pancam. References: [1] Gaddis, L. R., et al., 1999, J. Geophys. Res., 104 (E4), 8853-8868. [2] Kirk, R. L., et al., 1999, J. Geophys. Res., 104 (E4),  8869-8888. [3] Kirk, R. L., et al., LPS XXIX, 1844. 
