 PHOTOMETRIC MODELING FOR PLANETARY CARTOGRAPHY.  R. L. Kirk, K. T. Thompson, T. L. Becker, and E. M. Lee, U. S. Geological Survey, 2255 N. Gemini Drive, Flagstaff, AZ  86001 (rkirk@usgs.gov). Introduction:  We report on recent efforts to systematize and extend the tools for photometric normalization of images in the USGS Integrated Software for Imagers and Spectrometers (ISIS) [1].  The primary purpose of the software described is to adjust the brightness and contrast of planetary images obtained under different illumination and viewing geometries so that they appear as if obtained under uniform conditions and can be combined into mosaics that emphasize surface properties rather than illumination (e.g., [2, 3]).  This capability may be of interest to some readers.  In addition, photometric normalization of images for cartography requires photometric modeling to determine appropriate values for photometric parameters, and mosaicking the normalized images provides a test of the validity of parameter values that can compliment "conventional" photometric modeling approaches.  The subject is thus relevant to photometric studies of surface material properties and textures. Photometric Software:   A new ISIS program, PHOTOMET, is now available to perform photometric normalization of images. This single program supersedes the earlier PHOTOMPR and PHOTOM, which  were used in sequence, the first calculating and storing a grid of coefficients for brightness and contrast changes across the image and the second actually applying the correction. PHOTOMET takes advantage of the greater speed of modern computers to calculate and apply the correction for each pixel "on the fly" based on local photometric angles.  This approach simplifies the implementation of some kinds of photometric models (e.g., lunar models in which the phase function depends on the albedo [4]).  The photometric angles for each pixel can be calculated within PHOTOMET by using a simple reference surface model (sphere or ellipsoid). Alternatively, precomputed angles stored in ISIS backplanes can be used, which allows the possibility of photometric normalization based on a detailed topographic model of the surface. More important than the features just described is the modular design of PHOTOMET, which makes it possible to "mix and match" different combinations of modes of operation (equalization of albedo contrasts, topographic contrasts, or a combination), surface photometric models, and atmosphere models (or lack thereof).  In contrast, the older software had a limited set of surface models, offered atmospheric correction only for a Lambert surface, and did not provide topographic normalization. (One strength of PHOTOM was that users could write their own subroutines to perform functions not in the base systems; we have used this capability on occasion to perform topographic normalization, as illustrated in [5]). Modes of  Operation.  The intent of topographic normalization is to correct for the variation of incidence, emission, and phase angles within and between images and thus enhance departures from the uniform photometric model used to do the normalization; if there were no departures from the ideal model, the result would be a blank.  The most important ways real surfaces are nonuniform are local variations of intrinsic scattering properties (loosely, "albedo") and shading due to topographic slopes at the pixel scale.  In the absence of an atmosphere, the "albedo mode" is very simple:  the image is divided by the photometric model evaluated at the actual angles and then multiplied by the model at a reference geometry.  If an atmosphere is present, the additive component of atmospheric scattering is subtracted at the real conditions before the multiplicative step and added back as calculated for the standard conditions at the end. Topographic normalization involves both a multiplicative correction that adjusts the contrast for unit slope to reference conditions, and an additive correction to keep the average brightness uniform.  In practice, the albedo may be nonuniform, so a multistep process is used:  (1) PHOTOMET is run in "albedo mode," which decreases brightness variations across the individual image and removes the additive atmospheric contribution, if any; (2) the image is divided by a low-pass-filtered version of itself, which removes albedo variations if they have broader spatial scales than topographic shading as is often the case; and (3) PHOTOMET is run again in "topography mode,"  which undoes the albedo normalization of the first pass and then applies the topographic normalization per se. We have also implemented a "mixed mode" of normalization appropriate to images and mosaics (e.g., of the Galilean satellites) that span very large ranges of incidence angles.  In this mode, the albedo correction is applied at low incidence angles where albedo variations dominate topographic shading, and the topographic normalization is performed at large incidence angles where the reverse is true.  A user-specified parameter controls the incidence angle at which the smooth transition from one type of normalization to the other takes place.  We have not extended the mixed mode to incorporate atmospheric scattering. Surface Photometric Models.  All of the modes can be used with any of the available surface photometric models, which range from simple (Lambertian and Lommel-Seeliger or "lunar" with no parameters, lunar-Lambert, and Minnaert with a single parameter each) to Hapke's complex, physically motivated scattering law without [6] and with [7] macroscopic roughness effects.  In addition to the basic lunar-Lambert and Minnaert models with a constant value for their respective parameters, "empirical" versions of these functions are implemented, in which the user can supply tables of data indicating how both the parameter L or k (which mainly affects limb-darkening) and the relative brightness of the surface vary with phase angle (i.e., the phase curve).  Spline interpolation is used to evaluate parameters at phase angles between those in the table.  McEwen [8] has shown that with the appropriate limb-darkening and phase curves, these models can closely mimic the behavior of Hapke's law but are much faster to compute.  Unfortunately, his paper had room for only sample limb-darkening curves and no phase curves.  We have therefore implemented his fitting algorithm, with minor changes, as an ISIS program PHO_FIT_GLOBAL so that users can calculate their own tables.  These tables can be stored in text files that are accessed by PHOTOMET to simplify data entry. Atmospheric Scattering Models.  Our models attempt to balance the need for a relatively simple, fast calculation of the additive and multiplicative effects of atmospheric scattering with the desire for physical realism.  We use Chandrasekhar's [9] solution of the "planetary problem" of a slab atmosphere over a reflective surface (§72).  The derivation strictly applies only to a  Lambert surface because it takes account of the fraction of incident photons reflected from the surface but not their angular distribution.  We therefore  approximate the actual surface photometric model by numerically calculating the albedo of an "equivalent Lambert model."  For the term involving surface illumination of sunlight, we use the hemispheric albedo Ah, which is averaged over emission angle (see [6]) whereas for surface illumination by light from the atmosphere we use the bihemispheric albedo Ab, which is averaged over both incidence and emission angles.  In addition, we correct the overall result by assuming that the light that passes through atmosphere completely unscattered is reflected according to the detailed surface photometric model rather than by Lambert's (We do not apply the detailed surface law to light scattered in the atmosphere before hitting the surface; this would require calculation of and averaging over the detailed angular distribution of sky light, which would be prohibitively slow.  This effect will be unimportant if the surface is nearly Lambertian or if the sky light is only weakly directional.)  Our atmospheric scattering model can be written in the form where we use the symbol p for photometric functions (pstd is the solution to the "standard" problem of an atmospheric layer with no surface scattering, [9], Chapter IX), µ0 and µ are cosines of the incidence and emission angles for a level surface and µ0´ and µ´    p p A T sA T p A std hb surf h ( , , ) ( , , ) ( ) ( , , ) ( , , ) ( ( , , ) ( ) ) µ µ α µ µ α ρ µ µ µ µ α ρµ µ α ρ µ µ α µ µ 0 0 0 0 0 0 0 0 0 0 1= + −+ ′ ′ − PHOTOMETRIC MODELING FOR PLANETARY CARTOGRAPHY  R. L. Kirk, et al. are those including local topography, α is the phase angle, and ρ is a factor by which the local albedo departs from our model. Because the equation is nonlinear in ρ, we must explicitly introduce it and solve for it to do albedo normalization.  The atmospheric contribution pstd, overall transmission T, unscattered transmission T0, and s, which measures the amount of light scattered from sky to land, can all be evaluated in terms of Chandrasekhar's functions X and Y ([9], Chapter VIII).  We evaluate X and Y by using the firstand second-order expansions in the normal optical depth τ  given in §63 and §65.  The remaining parameters which control atmospheric scattering are the single-scattering albedo ωa and the asymmetry parameter x for the single-particle phase function 1+x cos(Θ). Applications and Discussion:  Icy Galilean Satellites.  The mixed albedo and topography normalization significantly benefits our global mosaics of the Galilean satellites [10], which include images with incidence angles from 0° to 90°.  Over most of this range, most of the contrast comes from albedo variations, but albedo normalization greatly exaggerates topographic shading near the terminator and one is left with the choice of accepting saturation or discarding otherwise useful image data.  With the mixed mode, contrast near the terminator matches the remainder of the image and little saturation occurs so the images need not be trimmed. Photometric parameters for the icy Galilean satellites merit discussion.  Much of the past photometric modeling of these bodies (McEwen [8] tabulates some older references and results; we are aware of newer work but lack room to cite it extensively here) involves fitting disk-integrated brightness as a function of phase angle.  The results of different authors and for leading and trailing hemispheres often differ substantially, at least in their parameter values.  A closer look suggests modeled single-particle phase functions agree fairly well over the range of phase angles for which images were available, but disagree at larger phase angles (e.g., [11]).  Fitting Minnaert and lunar-Lambert functions to various published Hapke models, however, indicates significant differences in the predicted limb darkening at phase angles for which data are available.  The idea that limb darkening provides information complimentary to the disk-integrated phase curve is not new.  We merely suggest that, whereas fitting the limb darkening of diskresolved images can be tricky because of albedo variations (e.g., [11], Fig. 8-10), making mosaics and checking the consistency of images where they overlap provides a check on scattering models that is not so sensitive to albedo variations.  By identifying which set of published Hapke parameters yield the best mosaics, we may be able to add to the understanding of the surfaces of the icy satellites. Martian Surface and Atmosphere.  Hapke parameters, or, equivalently, limb-darkening and phase curves for the full range of phase angles, are needed for normalization of images in our global mosaic of Mars [2, 3].  We believe that a plausible model results from using the fits of Johnson et al. [12] for  soils at the Mars Pathfinder landing site (e.g., Mermaid Dune) for all Hapke parameters except the macroscopic roughness θ, and adjustiνg θ to give agreement with limb-darkening estimated from Mariner 9 and Viking Orbiter images.  Tanaka and Davis [13] adjusted the Minnaert parameter k so that heights derived by photoclinometry on Viking images at phase angles 20°-80° agreed with shadow measurements on images at higher incidence angles; we reproduce their k values by fitting to Hapke's function with θ=20° over a restricted range of incidence angles (≤20°) as is appropriate for the photoclinometric observations. Thorpe's [14] values of k obtained by limbdarkening fits to Mariner 9 images can be matched by fitting over a full range of emission angles with θ=30°.  In that Tanaka and Davis were studying relatively smooth lava flows, we believe that the larger roughness value is probably a better global average.  In either case, fitting a Hapke model lets us extend the empirical results to a larger range of phase angles in a physically plausible way. Estimation of atmospheric scattering parameters for Mars is more problematic.  Single-scattering albedos and single-particle phase functions have been estimated by several authors, e.g., [15]. An albedo ωa =0.9 is probably reasonable at the wavelengths relevant to red- and clear-filter Viking Orbiter images.  A problem arises, however, in that the analytic phase function 1+x cos(Θ) cannot reproduce the extremely narrow and strong forwardscattering behavior observed for martian aerosols.  Thus, neglecting the directionality of sky light is not an especially good approximation. The shadow modeling described below yields systematic variations in our estimates of the surface albedo of Mars with phase angle (high inferred albedos for α≥110°) that we believe result from this failure to describe atmospheric scattering properly. Varying parameters such as ωa, x, and θ tends to increase or decrease the albedo for all observations in parallel; we have not found a parameter change that corrects the high apparent albedos at large phase angles.  Unfortunately, adding additional terms in the Legendre polynomial for single-particle scattering would complicate Chandrasekhar's derivation [9]  enormously.  Perhaps what is needed is an approximate treatment of the "standard" slabatmosphere problem in terms of anisotropic multiple scattering and arbitrary phase function for single scattering, similar to Hapke's [6] treatment of the problem for a half-space. The other difficulty in normalizing images of Mars with our software is that the optical depth τ varies with time and position and must be estimated fairly accurately (to ~10%) in order to obtain reasonable results.  We are using shadow measurements to estimate τ; since shadows are moderately rare, we use a single value of τ for all images in the global mosaic that come from a single Viking orbit.  Given a brightness measurement in shadow, one made nearby on an unshadowed, level surface, and the local illumination angles, ISIS program SHADOW_TAU uses the photometric assumptions described above to estimate the local albedo and τ. The results are model-dependent but in precisely the same way as the photometric normalization in which they are intended to be used.  Care must be taken to identify true shadows; apparent shadows that receive some illumination and that yield overestimates of the local τ  are common and are revealed by comparison with nearby measurements and the results of the image normalization. The (partial) success of photometric normalization based on such shadow measurements can be seen in Figure 1 of our companion abstract [3].  The shadow modeling needed to support mosaicking also provides a new way of estimating the spatial and temporal variation of atmospheric optical depth.  We are in  the process of comparing our results with the optical depths obtained by Martin [16] from IRTM data and will report on the results. References: [1] Eliason, E. M., 1997, Production of Digital Image models, LPS XVIII, 331; Gaddis L.R., et al., 1997, An Overview of the Integrated Software for Imaging Spectrometers, LPS XVIII, 387; Torson J., and Becker, K., 1997, ISIS—A Software Architecture for Processing Planetary Images, LPS XVIII, 1443. [2] Kirk, R. L., et al., 1999, Mars DIM: The Next Generation, LPS XXX, 1849. [3] Kirk, R. L., et al., 2000, MDIM 2.0: A Revised Global Image Mosaic of Mars, this volume. [4] McEwen, A. S., et al., 1996, A Precise Lunar Photometric Function, LPS XXVII, 841. [5] Croft, S. K., et al., 199?, Geology of Triton, in Neptune and Triton, U. of A. Press, Tucson, Fig. 21, p. 913.  [6] Hapke B., 1981, Bidirectional Reflectance Specroscopy 1. Theory, J. Geophys. Res., 86, 3039. [7] Hapke, B., 1984, Bidirectional Reflectance Spectroscopy 3. Correction for Macroscopic Roughess, Icarus, 59, 41. [8] McEwen, A. S., 1991, Photometric Functions for Photoclinometry and Other Applications, Icarus, 92, 298. [9] Chandrasekhar, S.,  1960,  Radiative Transfer, Dover, 393 pp.. [10] Becker, T. L., et al., 1999, Progress in Improvement of Geodetic Control and Production of Final Image Mosaics for Callisto and Ganymede, LPS XXX, 1692. [11] Domingue, D., and Verbiscer, A., 1997, ReAnalysis of the Solar Phase Curves of the Icy Galilean Satellites, Icarus, 128, 49. [12] Johnson, J. R., et al., 1999, Preliminary Results on Photometric Properties of Materials at the Sagan Memorial Station, Mars, J. Geophys. Res., 104, 8809. [13] Tanaka, K. L., and and Davis, P. A., 1988, Tectonic History of the Syria Planum Provice of Mars, J. Geophys. Res., 93, 14,893. [14] Thorpe, T. E., 1973, Mariner 9 Photometric Observations of Mars from November 1971 through March 1972, Icarus, 20, 482. [15] Pollack, J. B., et al., 1995, Viking Lander Image Analysis of Martian Atmospheric dust, J. Geophys. Res., 100, 5235; Tomasko, M. G., et al., 1999, Properties of Dust in the Martian Atmosphere from the Imager on Mars Pathfinder, J. Geophys. Res., 104, 8987; Markiewicz, W. J., et al., 1999, Optical Properties of Mars Aerosols as Derived from Imager for Mars Pathfinder Midday Sky Brightness Data, J. Geophys. Res., 104, 9009. [16] Martin, T. Z., and Richardson, M. I., 1993, New Dust Opacity Mapping from Viking Infrared Thermal Mapper Data, J. Geophys. Res., 98, 10,941. 
