 FULLY-CUSTOMIZED BASELINE REMOVAL APPLIED TO LIBS SPECTROSCOPY UNDER MARS CONDITIONS. Stephen Giguere1, M. Darby Dyar2, CJ Carey1, Thomas Boucher1, and Sridhar Mahadevan1, 1School of Computer Science, University of Massachusetts Amherst, Amherst MA 01003, USA, sgiguere@cs.umass.edu, 2Dept. of Astronomy, Mount Holyoke College, South Hadley, MA 01075.  Introduction: Due to the multitude of available baseline removal methods and the effort required to tune them, spectroscopists often pay little attention to optimizing baseline removal. It is common, for example, to only test a single method, use default parameters and/or rely on manual "eyeballing" of goodness of fit to select parameter values. However, recent work [1,2] on LIBS, Raman, and FTIR spectra shows that removal of the baseline (or continuum in the case of LIBS) can have a major effect of the accuracy of mineral identifications and chemical predictions. We have recently developed a fully-customized method for optimizing baseline removal [3,4] that shows promise in initial experiments. Here, we further explore the effect of baseline removal (BLR) by evaluating prediction accuracy for 13 elements of geological interest using LIBS spectra. We test the hypothesis that customizing baseline removal to each prediction task separately will improve prediction accuracy. Methods: We employ LIBS data collected on three different sample suites (designated LANL, MHC Big, and Doped) and two instruments to obtain a generalizable result. For major elements, we used the 326 calibration standards run on the ChemCam-like LIBS at Los Alamos National Laboratory (LANL), conducted with 14 mJ/pulse focused to a 250 Î¼m spot size on samples 1.5 m away in 7 Torr CO2 to simulate the Martian surface pressure [5]. A second set of major element predictions was undertaken using ~300 samples from our in-house laboratory calibration standards [6]. For minor elements, we used 175 samples doped with varying amounts of Ni, Cr, Mn, Zn, and Co [7]. The latter two data sets were collected on the MHC Mars-analog LIBS using three Ocean Optics HR2000+ spectrometers and a Quantel Ultra100 laser operating at 1064 nm, up to 15 mJ/pulse, 10 Hz, with a 6-ns pulse width -- also under a 7-Torr CO2 atmosphere. Three different laser power densities bracketing those obtained on Mars (~2 GW/cm2) were used to measure all MHC samples, so there are three spectra for each sample. All spectra were preprocessed using pipelines analogous to those used for ChemCam data on Mars, with the notable exception that baselines were not removed. All data were normalized to the total intensity of each of the three spectrometers (UV, VIS, and NIR). We tested eight different BLR methods for each variable in each data set; each had at least one adjustable parameter (Table 1). The methods (described in more detail in [1]) included Asymmetric Least Squares (ALS)[8], Adaptive Iteratively Reweighted Penalized Least Squares (Air-PLS)[8], Dietrich [10], Fully Automatic Baseline Correction (FABC)[11], polynomial fitting (Poly-Fit)[12], a convex hull method (Rubber Band), wavelet transform (Wavelet)[13], and the fullycustomize version described here (Custom) [3,4]. Computational Methods: To quantify the results of our models, we compared the root-mean-square error (RMSE) of the calibration curves produced by each method. For this, we created a 4-step pipeline: (1) input LIBS data, (2) select baseline correction method with random parameter values (e.g., smoothness parameter in Whittaker smoothing methods) drawn uniformly from appropriate ranges, (3) perform cross validation (CV) with processed spectra and a 10component partial least squares (PLS) model, and (4) choose the mean RMSE across CV-folds record chosen method and parameters. For each method, the pipeline is run 100 times, recording the lowest RMSE observed. Results: Several different types of baseline removal were used, including no BLR. First, each of the three data sets was used to predict the elements of interest using the default values of each of the eight BLR techniques given in Table 1. Next, the optimization routine described previously was used to estimate the best possible result from each of the eight BLR techniques by randomly exploring the space of each adjustable parameter ("opt." in Table 2). Finally, the custom baseline optimization routine, which creates a novel BLR for each element, was tested.  Comparison of the LANL and MHC sets shows that prediction accuracy is usually better for the LANL data set when compared against MHC. This is unsurprising because the LANL data were acquired under identical conditions using constant power density while the MHC spectra were acquired using three different laser powers. Because they were deliberately chosen to represent a more diverse sent of chemical compositions, the MHC models sacrifice accuracy in exchange for broader generalizability, such as to Martian data sets with highly variable plasmas [15]. The first column of Table 2 data lists the average Table 1. Baseline Removal Parameters Defaults Method Parameter ALS Smoothness=1E6, Asymmetry = 0.010 Air-PLS Smoothness =100 Dietrich Half-window = 16, # Erosions = 10 FABC Smoothness = 1000, Dilation = 50 Poly-Fit Polynomial order = 5, Threshold #Standard Deviations = 3 Rubber Band #Iterations = 8, #Ranges = 64 Wavelet Filter length = 4, Level = 9 Custom Not applicable  rank of each approach relative to the others (1 is best, 16 worst), providing a quantitative score of overall performance. Predictions given in subsequent columns using published BLR methods show no clear advantage of one technique over any other across our three data sets, although Rubber Band, Air-PLS, PolyFit tend to perform well. In all cases, BLR using optimized parameters outperforms default adjustable parameter(s). Interestingly, using default parameters often produces worse results than applying no BLR. Custom BLR produces the most accurate predictions overall, with significant improvements over no BLR, such as 4% improvement for SiO2 and 12% for FeOT. In cases where it is outperformed by existing algorithms, Custom BLR still yields competitive results, making it a good candidate for general purpose use.  In all cases, customized BLR outperforms the null case of no BLR, though the margin is sometimes slim. Baseline removal might not be needed in situations where training and test sets are acquired on the identical instrument and the test population is always quite similar to that used for training. However, it is likely that some kind of baseline removal is needed for crossplatform comparisons, and in these cases, customizing BLR consistently produces more accurate results. Acknowledgments: Work supported by NSF grant CHE-1306133 and NASA grants NNX12AK84G and NNX15AC82G. References: [1] Carey CJ et al. (2015) LPS LXXVI, Abstract #2464. [2] Giguere S. et al. (2015) LPS LXXVI, Abstract #2775. [3] Giguere S. (2015) Intl. Joint Conf. Artificial Intelligence. [4] Giguere S. et al. (2015) Sci-X 2015, paper #288. [5] Clegg S. et al. (2014) LPS LXXV, Abstract #2378. [6] Dyar M.D. (2015) LPS LXXVI, Abstract #1510. [7] Breves E. et al. (2015) LPS LXXVI, Abstract #2338. [8] Eilers P. H. C. and Boelens H. F. M. (2005) Leiden Univ. Med. Centre Rep. http://www.science.uva.nl/~hboelens/. [9] Zhang Z.-M. et al. (2010) Analyst, 135, 1138-1146. [10] Dietrich W. et al. (1991) J. Mag. Reson., 91, 1-11. [11] Cobas J. C. et al. (2006) J. Mag. Reson., 183, 145151. [12] Gan F. et al. (2006) Chemom. Intell. Lab. Syst., 82, 59-65. [15] Tokar R.L. et al. (2015) LPS LXXVI, Abstract #1369.  Table 2. RMSE Values for Elements Predicted Using Varying BLR Routines and Parameters   LANL MHC LANL MHC LANL MHC LANL MHC LANL MHC Technique Rank Wt.% SiO2 Wt.% Al2O3 Wt.% TiO2 Wt.% FeOT Wt.% MgO No BLR 9.76 4.94 5.52 2.04 2.75 0.39 0.59 3.59 3.13 1.40 1.85 Air-PLS default 11.48 4.94 5.78 2.04 2.84 0.39 0.60 3.59 3.44 1.40 2.01 ALS default 11.76 5.13 5.78 2.04 2.72 0.36 0.61 3.31 3.19 1.50 1.96 Dietrich default 9.76 5.17 5.21 2.05 2.74 0.39 0.59 3.12 2.79 1.35 1.86 FABC default 11.19 5.05 5.45 2.02 2.77 0.40 0.62 3.07 2.79 1.37 1.95 Poly-Fit default 11.81 5.61 5.38 2.19 2.77 0.43 0.57 3.62 2.73 1.45 1.95 Rub. Band default 11.52 5.14 5.54 2.02 2.76 0.39 0.59 3.79 3.03 1.42 1.90 Wavelet default 11.29 5.60 5.51 2.08 2.72 0.39 0.60 3.24 2.92 1.30 1.93 Air-PLS opt. 4.29 4.89 5.39 2.00 2.69 0.36 0.59 3.01 2.90 1.34 1.84 ALS opt. 7.24 4.97 5.47 2.04 2.71 0.39 0.58 3.59 3.05 1.35 1.88 Dietrich opt. 10.76 5.00 5.53 2.01 2.73 0.39 0.59 3.47 3.24 1.42 1.86 FABC opt. 6.81 4.96 5.44 1.98 2.69 0.36 0.59 2.92 3.07 1.40 1.85 Poly-Fit opt. 5.29 4.89 5.47 1.99 2.69 0.38 0.58 3.59 2.87 1.34 1.82 Rubber Band opt. 4.00 4.95 5.26 1.95 2.65 0.38 0.57 3.23 2.89 1.32 1.78 Wavelet opt. 7.33 4.94 5.48 2.00 2.72 0.39 0.58 3.59 3.01 1.39 1.85 Custom opt. 2.10 4.75 5.18 1.95 2.71 0.34 0.56 2.81 2.74 1.35 1.72  LANL MHC LANL MHC LANL MHC Doped Doped Doped Doped Doped Technique Wt.% CaO Wt.% Na2O Wt.% K2O Ni Zn Mn Cr Co No BLR 1.38 2.04 0.67 0.57 0.70 0.74 589 637 457 546 494 Air-PLS default 1.38 2.10 0.67 0.58 0.70 0.74 682 581 465 776 598 ALS default 1.44 2.00 0.72 0.57 0.75 0.74 727 612 475 775 594 Dietrich default 1.43 2.02 0.67 0.57 0.71 0.75 703 578 466 794 617 FABC default 1.36 2.07 0.66 0.57 0.70 0.75 655 666 498 820 595 Poly-Fit default 1.63 2.02 0.67 0.56 0.72 0.81 714 595 468 797 604 Rub. Band default 1.66 2.00 0.68 0.56 0.72 0.74 694 603 456 853 603 Wavelet default 1.61 2.00 0.66 0.60 0.71 0.75 720 620 463 795 619 Air-PLS opt. 1.26 1.99 0.63 0.55 0.68 0.72 579 629 445 537 487 ALS opt. 1.36 1.99 0.62 0.56 0.68 0.73 582 633 445 535 477 Dietrich opt. 1.42 2.03 0.67 0.56 0.71 0.73 589 637 457 546 494 FABC opt. 1.33 2.00 0.63 0.56 0.69 0.73 589 633 451 524 487 Poly-Fit opt. 1.35 1.96 0.64 0.56 0.67 0.73 575 630 454 502 474 Rubber Band opt. 1.33 1.96 0.63 0.54 0.68 0.72 575 629 455 524 466 Wavelet opt. 1.36 2.01 0.63 0.55 0.69 0.73 572 632 441 521 475 Custom opt. 1.23 1.87 0.57 0.53 0.67 0.71 575 626 436 298 471  